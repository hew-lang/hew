type Resource {
    id: int;
}

impl Drop for Resource {
    fn drop(self: Resource) {
        print("drop ");
        println(self.id);
    }
}

fn main() -> int {
    // Test 1: labeled break from nested loop drops intermediate scope resources
    println("test1");
    @outer: while true {
        let a = Resource { id: 1 };
        var i = 0;
        while true {
            let b = Resource { id: 2 };
            if i == 0 {
                break @outer;
            }
            i = i + 1;
        }
    }
    println("after outer");

    // Test 2: labeled continue from nested loop drops intermediate scope resources
    println("test2");
    var count = 0;
    @outer2: while count < 1 {
        let c = Resource { id: 3 };
        count = count + 1;
        var j = 0;
        while true {
            let d = Resource { id: 4 };
            if j == 0 {
                continue @outer2;
            }
            j = j + 1;
        }
    }
    println("after outer2");

    // Test 3: 3-level nesting â€” break @outer should stop ALL intermediate loops
    println("test3");
    @outer3: while true {
        let e = Resource { id: 5 };
        var k = 0;
        while true {
            let f = Resource { id: 6 };
            var m = 0;
            while true {
                let g = Resource { id: 7 };
                if m == 0 {
                    break @outer3;
                }
                m = m + 1;
            }
            k = k + 1;
        }
    }
    println("after outer3");

    return 0;
}
