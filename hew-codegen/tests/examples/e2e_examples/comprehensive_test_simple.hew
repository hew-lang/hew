// Comprehensive End-to-End Test for Hew Language
// Tests core codegen features to verify they work correctly

// === Type Declarations ===
type Point {
    x: int;
    y: int;
}

enum Color {
    Red;
    Green;
    Blue;
}

// === Helper Functions ===
fn run_test(name: String, result: int) -> int {
    if result == 1 {
        println(string_concat(string_concat("Test ", name), " ... PASS"));
    } else {
        println(string_concat(string_concat("Test ", name), " ... FAIL"));
    }
    result
}

// === Test 1: Arithmetic Operations ===
fn test_arithmetic() -> int {
    let a = 10;
    let b = 5;
    let add_result = a + b; // 15
    let sub_result = a - b; // 5  
    let mul_result = a * b; // 50
    let div_result = a / b; // 2
    let mod_result = a % b; // 0
    if add_result == 15 {
        if sub_result == 5 {
            if mul_result == 50 {
                if div_result == 2 {
                    if mod_result == 0 {
                        1
                    } else {
                        0
                    }
                } else {
                    0
                }
            } else {
                0
            }
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 2: Let and Var Declarations ===
fn test_variables() -> int {
    let immutable = 42;
    var mutable = 10;
    mutable = mutable + 5;
    if immutable == 42 {
        if mutable == 15 {
            1
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 3: If/Else Statements and Expressions ===
fn test_if_else() -> int {
    let x = 10;
    let y = if x > 5 {
        1
    } else {
        0
    };
    var result = 0;
    if x == 10 {
        result = 1;
    } else {
        result = 0;
    }
    if y == 1 {
        if result == 1 {
            1
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 4: While Loops with Break and Continue ===
fn test_while_loops() -> int {
    var i = 0;
    var sum = 0;
    var found_five = 0;
    while i < 10 {
        if i == 3 {
            i = i + 1;
            continue;
        }
        if i == 5 {
            found_five = 1;
        }
        if i == 8 {
            break;
        }
        sum = sum + i;
        i = i + 1;
    }
    // Should skip 3, break at 8: sum = 0+1+2+4+5+6+7 = 25
    if sum == 25 {
        if found_five == 1 {
            1
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 5: Match Expressions ===
fn test_match() -> int {
    let color_tag = 1; // Green
    let result = match color_tag {
        0 => 10,
        1 => 20,
        2 => 30,
        _ => 0,
    }; // Red // Green   // Blue // Default
    let nested_result = match result {
        20 => {
            let temp = 100;
            temp + 50
        },
        _ => 0,
    };
    if result == 20 {
        if nested_result == 150 {
            1
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 6: Function Parameters and Return Types ===
fn add_numbers(a: int, b: int) -> int {
    a + b
}

fn multiply_by_two(x: int) -> int {
    x * 2
}

fn test_functions() -> int {
    let sum = add_numbers(5, 7);
    let doubled = multiply_by_two(sum);
    if sum == 12 {
        if doubled == 24 {
            1
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 7: String Operations ===
fn test_strings() -> int {
    let hello = "Hello";
    let world = "World";
    let len = string_length(hello);
    let combined = string_concat(hello, world);
    let equals_self = string_equals(hello, hello);
    let not_equals = string_equals(hello, world);
    if len == 5 {
        if equals_self {
            if !not_equals {
                1
            } else {
                0
            }
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 8: Nested Function Calls ===
fn inner_function(x: int) -> int {
    x + 1
}

fn middle_function(y: int) -> int {
    inner_function(y * 2)
}

fn outer_function(z: int) -> int {
    middle_function(z + 3)
}

fn test_nested_calls() -> int {
    let result = outer_function(5); // (5+3)*2+1 = 17
    if result == 17 {
        1
    } else {
        0
    }
}

// === Test 9: Comparison Operators ===
fn test_comparisons() -> int {
    let a = 10;
    let b = 5;
    let c = 10;
    let eq = if a == c {
        1
    } else {
        0
    };
    let ne = if a != b {
        1
    } else {
        0
    };
    let gt = if a > b {
        1
    } else {
        0
    };
    let ge = if a >= c {
        1
    } else {
        0
    };
    let lt = if b < a {
        1
    } else {
        0
    };
    let le = if b <= a {
        1
    } else {
        0
    };
    if eq == 1 {
        if ne == 1 {
            if gt == 1 {
                if ge == 1 {
                    if lt == 1 {
                        if le == 1 {
                            1
                        } else {
                            0
                        }
                    } else {
                        0
                    }
                } else {
                    0
                }
            } else {
                0
            }
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 10: Boolean Logic ===
fn test_boolean_logic() -> int {
    let true_val = 1;
    let false_val = 0;
    let and_result = if true_val == 1 {
        if false_val == 0 {
            1
        } else {
            0
        }
    } else {
        0
    };
    let or_result = if true_val == 1 {
        1
    } else {
        if false_val == 1 {
            1
        } else {
            0
        }
    };
    let not_result = if false_val != 1 {
        1
    } else {
        0
    };
    if and_result == 1 {
        if or_result == 1 {
            if not_result == 1 {
                1
            } else {
                0
            }
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 11: Return Statements ===
fn test_early_return(x: int) -> int {
    if x < 0 {
        return -1;
    }
    if x == 0 {
        return 0;
    }
    x * 2
}

fn test_returns() -> int {
    let neg = test_early_return(-5);
    let zero = test_early_return(0);
    let pos = test_early_return(10);
    if neg == -1 {
        if zero == 0 {
            if pos == 20 {
                1
            } else {
                0
            }
        } else {
            0
        }
    } else {
        0
    }
}

// === Test 12: Complex Expression ===
fn test_complex_expression() -> int {
    let a = 5;
    let b = 3;
    let c = 2;
    let result = ((a + b) * c - 1) / (a - c); // ((8) * 2 - 1) / 3 = 15/3 = 5
    if result == 5 {
        1
    } else {
        0
    }
}

// === Main Function ===
fn main() -> int {
    println("=== Hew Comprehensive Test Suite ===");
    println("");
    var passed = 0;
    var total = 0;
    // Run all tests and count results
    total = total + 1;
    if run_test("Arithmetic", test_arithmetic()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Variables", test_variables()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("If/Else", test_if_else()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("While Loops", test_while_loops()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Match", test_match()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Functions", test_functions()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Strings", test_strings()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Nested Calls", test_nested_calls()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Comparisons", test_comparisons()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Boolean Logic", test_boolean_logic()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Returns", test_returns()) == 1 {
        passed = passed + 1;
    }
    total = total + 1;
    if run_test("Complex Expression", test_complex_expression()) == 1 {
        passed = passed + 1;
    }
    println("");
    println("=== Test Summary ===");
    println("Passed: ");
    println(passed);
    println("Total: ");
    println(total);
    if passed == total {
        println("All tests passed!");
        0
    } else {
        println("Some tests failed!");
        1
    }
}
